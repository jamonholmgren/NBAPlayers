import { ApiResponse } from "apisauce"
import { Api } from "./api"
import { GetPlayersResult } from "./api.types"
import { getGeneralApiProblem } from "./api-problem"

const API_PAGE_SIZE = 50

export class PlayerApi {
  private api: Api

  constructor(api: Api) {
    this.api = api
  }

  async getPlayers(): Promise<GetPlayersResult> {
    try {
      // make the api call
      const response: ApiResponse<any> = await this.api.apisauce.get(
        "https://raw.githubusercontent.com/alexnoob/BasketBall-GM-Rosters/master/2020-21.NBA.Roster.json",
        { amount: API_PAGE_SIZE },
      )

      // the typical ways to die when calling an api
      if (!response.ok) {
        const problem = getGeneralApiProblem(response)
        if (problem) return problem
      }

      const players = response.data.players

      return { kind: "ok", players }
    } catch (e) {
      __DEV__ && console.tron.log(e.message)
      return { kind: "bad-data" }
    }
  }
}

// Example "player" from the API
const player = {
  tid: 5,
  name: "Kevin Love",
  ratings: [
    {
      hgt: 65,
      stre: 75,
      spd: 47,
      jmp: 55,
      endu: 62,
      ins: 69,
      dnk: 72,
      ft: 67,
      fg: 72,
      tp: 65,
      diq: 32,
      oiq: 41,
      drb: 46,
      pss: 56,
      reb: 96,
    },
  ],
  pos: "PF",
  hgt: 80,
  weight: 251,
  born: { year: 1989, loc: "Santa Monica, CA" },
  imgURL:
    "https://ak-static.cms.nba.com/wp-content/uploads/headshots/nba/latest/260x190/201567.png",
  contract: { amount: 31250, exp: 2023 },
  transactions: [{ season: 2014, tid: 5, type: "trade", fromTid: 17 }],
  draft: { round: 1, pick: 5, tid: 14, originalTid: 14, year: 2008 },
  college: "UCLA",
  awards: [
    { season: 2016, type: "Won Championship" },
    { season: 2011, type: "Most Improved Player" },
    { season: 2012, type: "Second Team All-League" },
    { season: 2014, type: "Second Team All-League" },
    { season: 2011, type: "League Rebounding Leader" },
    { season: 2011, type: "All-Star" },
    { season: 2012, type: "All-Star" },
    { season: 2014, type: "All-Star" },
    { season: 2017, type: "All-Star" },
    { season: 2018, type: "All-Star" },
  ],
  stats: [
    {
      playoffs: false,
      yearsWithTeam: 1,
      season: 2009,
      tid: 17,
      gp: 81,
      gs: 37,
      min: 2048,
      fg: 316,
      fga: 688,
      tp: 2,
      tpa: 19,
      ft: 265,
      fta: 336,
      orb: 274,
      drb: 460,
      ast: 84,
      stl: 35,
      blk: 50,
      ba: 78,
      tov: 118,
      pf: 205,
      pts: 899,
      pm: -271,
      ewa: 7,
      per: 18.3,
      orbp: 15.1,
      drbp: 27.3,
      trbp: 21,
      astp: 6.8,
      stlp: 0.9,
      blkp: 1.9,
      usgp: 21,
      ows: 3.4,
      dws: 1.9,
      ortg: 103.3,
      drtg: 109.4,
      jerseyNumber: "42",
    },
    {
      playoffs: false,
      yearsWithTeam: 2,
      season: 2010,
      tid: 17,
      gp: 60,
      gs: 22,
      min: 1714,
      fg: 291,
      fga: 646,
      tp: 35,
      tpa: 106,
      ft: 225,
      fta: 276,
      orb: 227,
      drb: 431,
      ast: 136,
      stl: 43,
      blk: 23,
      ba: 60,
      tov: 117,
      pf: 136,
      pts: 842,
      pm: -225,
      ewa: 7.9,
      per: 20.7,
      orbp: 14.5,
      drbp: 28.6,
      trbp: 21.5,
      astp: 12.9,
      stlp: 1.3,
      blkp: 1,
      usgp: 22.4,
      ows: 3.4,
      dws: 1.5,
      ortg: 102.1,
      drtg: 108.7,
      jerseyNumber: "42",
    },
    {
      playoffs: false,
      yearsWithTeam: 3,
      season: 2011,
      tid: 17,
      gp: 73,
      gs: 73,
      min: 2611,
      fg: 482,
      fga: 1026,
      tp: 88,
      tpa: 211,
      ft: 424,
      fta: 499,
      orb: 330,
      drb: 782,
      ast: 184,
      stl: 45,
      blk: 28,
      ba: 96,
      tov: 155,
      pf: 148,
      pts: 1476,
      pm: -272,
      ewa: 16.7,
      per: 24.3,
      orbp: 13.7,
      drbp: 34.2,
      trbp: 23.6,
      astp: 11.8,
      stlp: 0.9,
      blkp: 0.8,
      usgp: 22.9,
      ows: 8.9,
      dws: 2.5,
      ortg: 104.2,
      drtg: 109.5,
      jerseyNumber: "42",
      minMax: [46],
      fgMax: [14],
      fgaMax: [26],
      tpMax: [5],
      tpaMax: [6],
      "2pMax": [10],
      "2paMax": [22],
      ftMax: [18],
      ftaMax: [23],
      pmMax: [32],
      orbMax: [12],
      drbMax: [19],
      trbMax: [31],
      astMax: [7],
      stlMax: [2],
      blkMax: [2],
      tovMax: [5],
      pfMax: [5],
      ptsMax: [43],
      gmscMax: [38.9],
    },
    {
      playoffs: false,
      yearsWithTeam: 4,
      season: 2012,
      tid: 17,
      gp: 55,
      gs: 55,
      min: 2145,
      fg: 474,
      fga: 1059,
      tp: 105,
      tpa: 282,
      ft: 379,
      fta: 460,
      orb: 226,
      drb: 508,
      ast: 111,
      stl: 47,
      blk: 28,
      ba: 65,
      tov: 128,
      pf: 152,
      pts: 1432,
      pm: 26,
      ewa: 14.8,
      per: 25.4,
      orbp: 11.6,
      drbp: 26.4,
      trbp: 19,
      astp: 10,
      stlp: 1.1,
      blkp: 0.9,
      usgp: 28.8,
      ows: 7.6,
      dws: 2.3,
      ortg: 105.4,
      drtg: 104.8,
      jerseyNumber: "42",
      minMax: [49],
      fgMax: [16],
      fgaMax: [31],
      tpMax: [7],
      tpaMax: [11],
      "2pMax": [12],
      "2paMax": [24],
      ftMax: [19],
      ftaMax: [24],
      pmMax: [25],
      orbMax: [9],
      drbMax: [18],
      trbMax: [21],
      astMax: [5],
      stlMax: [3],
      blkMax: [4],
      tovMax: [6],
      pfMax: [5],
      ptsMax: [51],
      gmscMax: [40.0],
    },
    {
      playoffs: false,
      yearsWithTeam: 5,
      season: 2013,
      tid: 17,
      gp: 18,
      gs: 18,
      min: 618,
      fg: 105,
      fga: 298,
      tp: 20,
      tpa: 92,
      ft: 100,
      fta: 142,
      orb: 64,
      drb: 188,
      ast: 42,
      stl: 13,
      blk: 9,
      ba: 33,
      tov: 39,
      pf: 34,
      pts: 330,
      pm: 2,
      ewa: 2,
      per: 17.9,
      orbp: 11.5,
      drbp: 35.9,
      trbp: 23.3,
      astp: 11.8,
      stlp: 1.1,
      blkp: 1.1,
      usgp: 28.9,
      ows: 0.1,
      dws: 0.9,
      ortg: 101.9,
      drtg: 101.9,
      jerseyNumber: "42",
    },
    {
      playoffs: false,
      yearsWithTeam: 6,
      season: 2014,
      tid: 17,
      gp: 77,
      gs: 77,
      min: 2797,
      fg: 650,
      fga: 1421,
      tp: 190,
      tpa: 505,
      ft: 520,
      fta: 633,
      orb: 224,
      drb: 739,
      ast: 341,
      stl: 59,
      blk: 35,
      ba: 63,
      tov: 196,
      pf: 136,
      pts: 2010,
      pm: 356,
      ewa: 21.5,
      per: 26.9,
      orbp: 8.5,
      drbp: 29.5,
      trbp: 18.7,
      astp: 21.4,
      stlp: 1,
      blkp: 1,
      usgp: 28.8,
      ows: 10.6,
      dws: 3.7,
      ortg: 110.5,
      drtg: 104.6,
      jerseyNumber: "42",
    },
    {
      playoffs: false,
      yearsWithTeam: 1,
      season: 2015,
      tid: 5,
      gp: 75,
      gs: 75,
      min: 2532,
      fg: 413,
      fga: 952,
      tp: 144,
      tpa: 392,
      ft: 258,
      fta: 321,
      orb: 142,
      drb: 589,
      ast: 168,
      stl: 51,
      blk: 39,
      ba: 56,
      tov: 122,
      pf: 140,
      pts: 1228,
      pm: 399,
      ewa: 9.3,
      per: 18.8,
      orbp: 6.5,
      drbp: 26.3,
      trbp: 16.6,
      astp: 10.7,
      stlp: 1,
      blkp: 1.2,
      usgp: 21.7,
      ows: 5.8,
      dws: 2.9,
      ortg: 111.1,
      drtg: 103.6,
      jerseyNumber: "0",
    },
    {
      playoffs: true,
      season: 2015,
      tid: 5,
      gp: 4,
      gs: 4,
      min: 107,
      fg: 17,
      fga: 41,
      tp: 9,
      tpa: 21,
      ft: 14,
      fta: 19,
      orb: 6,
      drb: 22,
      ast: 10,
      stl: 1,
      blk: 2,
      ba: 5,
      tov: 6,
      pf: 12,
      pts: 57,
      pm: 36,
      ewa: 0.5,
      per: 20,
      orbp: 6.3,
      drbp: 22.3,
      trbp: 14.4,
      astp: 16.9,
      stlp: 0.5,
      blkp: 1.6,
      usgp: 23.5,
      ows: 0.3,
      dws: 0.1,
      ortg: 121,
      drtg: 105.3,
    },
    {
      playoffs: false,
      yearsWithTeam: 2,
      season: 2016,
      tid: 5,
      gp: 77,
      gs: 77,
      min: 2424,
      fg: 409,
      fga: 977,
      tp: 158,
      tpa: 439,
      ft: 258,
      fta: 314,
      orb: 149,
      drb: 613,
      ast: 186,
      stl: 58,
      blk: 41,
      ba: 52,
      tov: 142,
      pf: 159,
      pts: 1234,
      pm: 428,
      ewa: 9.1,
      per: 19,
      orbp: 7,
      drbp: 28.4,
      trbp: 17.8,
      astp: 12.2,
      stlp: 1.2,
      blkp: 1.4,
      usgp: 23.4,
      ows: 4.7,
      dws: 3.8,
      ortg: 112.4,
      drtg: 103.6,
      jerseyNumber: "0",
    },
    {
      playoffs: true,
      season: 2016,
      tid: 5,
      gp: 20,
      gs: 19,
      min: 613,
      fg: 92,
      fga: 239,
      tp: 46,
      tpa: 111,
      ft: 63,
      fta: 75,
      orb: 34,
      drb: 141,
      ast: 42,
      stl: 9,
      blk: 8,
      ba: 15,
      tov: 27,
      pf: 34,
      pts: 293,
      pm: 160,
      ewa: 2,
      per: 17.9,
      orbp: 6.6,
      drbp: 26.8,
      trbp: 16.9,
      astp: 10.6,
      stlp: 0.8,
      blkp: 1.3,
      usgp: 22.5,
      ows: 1.3,
      dws: 0.7,
      ortg: 120.2,
      drtg: 106.9,
    },
    {
      playoffs: false,
      yearsWithTeam: 3,
      season: 2017,
      tid: 5,
      gp: 60,
      gs: 60,
      min: 1885,
      fg: 370,
      fga: 867,
      tp: 145,
      tpa: 389,
      ft: 257,
      fta: 295,
      orb: 148,
      drb: 518,
      ast: 116,
      stl: 53,
      blk: 21,
      ba: 59,
      tov: 122,
      pf: 125,
      pts: 1142,
      pm: 337,
      ewa: 9.1,
      per: 21.1,
      orbp: 8.9,
      drbp: 29.3,
      trbp: 19.5,
      astp: 9.8,
      stlp: 1.4,
      blkp: 0.9,
      usgp: 26.4,
      ows: 4,
      dws: 2.4,
      ortg: 115.5,
      drtg: 107.1,
      jerseyNumber: "0",
    },
    {
      playoffs: true,
      season: 2017,
      tid: 5,
      gp: 18,
      gs: 18,
      min: 578,
      fg: 95,
      fga: 218,
      tp: 50,
      tpa: 111,
      ft: 63,
      fta: 75,
      orb: 36,
      drb: 155,
      ast: 30,
      stl: 21,
      blk: 16,
      ba: 12,
      tov: 31,
      pf: 46,
      pts: 303,
      pm: 147,
      ewa: 2.4,
      per: 19.7,
      orbp: 7.6,
      drbp: 29.7,
      trbp: 19.3,
      astp: 7.5,
      stlp: 1.8,
      blkp: 2.3,
      usgp: 21.8,
      ows: 1.3,
      dws: 0.9,
      ortg: 121,
      drtg: 108.8,
    },
    {
      playoffs: false,
      yearsWithTeam: 4,
      season: 2018,
      tid: 5,
      gp: 59,
      gs: 59,
      min: 1651,
      fg: 334,
      fga: 729,
      tp: 137,
      tpa: 330,
      ft: 234,
      fta: 266,
      orb: 101,
      drb: 445,
      ast: 103,
      stl: 43,
      blk: 24,
      ba: 50,
      tov: 90,
      pf: 120,
      pts: 1039,
      pm: 77,
      ewa: 9.7,
      per: 22.4,
      orbp: 7,
      drbp: 29.8,
      trbp: 18.6,
      astp: 9.8,
      stlp: 1.3,
      blkp: 1.2,
      usgp: 25.1,
      ows: 4.7,
      dws: 1.6,
      ortg: 112.7,
      drtg: 111.3,
      jerseyNumber: "0",
    },
    {
      playoffs: true,
      season: 2018,
      tid: 5,
      gp: 21,
      gs: 21,
      min: 660,
      fg: 109,
      fga: 278,
      tp: 36,
      tpa: 106,
      ft: 59,
      fta: 64,
      orb: 49,
      drb: 166,
      ast: 34,
      stl: 15,
      blk: 8,
      ba: 22,
      tov: 41,
      pf: 58,
      pts: 313,
      pm: -14,
      ewa: 1.3,
      per: 15.5,
      orbp: 8.6,
      drbp: 30.6,
      trbp: 19.4,
      astp: 8.6,
      stlp: 1.2,
      blkp: 1.1,
      usgp: 24.3,
      ows: 0.3,
      dws: 0.7,
      ortg: 108.1,
      drtg: 110.2,
    },
    {
      playoffs: false,
      yearsWithTeam: 5,
      season: 2019,
      tid: 5,
      gp: 22,
      gs: 21,
      min: 598,
      fg: 109,
      fga: 283,
      tp: 53,
      tpa: 147,
      ft: 103,
      fta: 114,
      orb: 33,
      drb: 206,
      ast: 48,
      stl: 6,
      blk: 5,
      ba: 17,
      tov: 42,
      pf: 54,
      pts: 374,
      pm: -56,
      ewa: 2.4,
      per: 19.5,
      orbp: 5.9,
      drbp: 40,
      trbp: 22.2,
      astp: 12.8,
      stlp: 0.5,
      blkp: 0.7,
      usgp: 27.4,
      ows: 1,
      dws: 0.4,
      ortg: 110.5,
      drtg: 114.7,
      jerseyNumber: "0",
    },
    {
      playoffs: false,
      yearsWithTeam: 6,
      season: 2020,
      jerseyNumber: "0",
      tid: 5,
      gp: 56,
      gs: 56,
      min: 1780,
      fg: 327,
      fga: 727,
      tp: 146,
      tpa: 390,
      ft: 187,
      fta: 219,
      orb: 54,
      drb: 493,
      ba: 22,
      ast: 178,
      stl: 33,
      blk: 19,
      tov: 140,
      pf: 90,
      pts: 987,
      pm: -268,
      per: 17.9,
      ortg: 104,
      drtg: 109,
      orbp: 3.3,
      drbp: 31.1,
      trbp: 17.1,
      astp: 15.4,
      stlp: 0.9,
      blkp: 0.9,
      usgp: 23.1,
      ows: 2.5,
      dws: 1.3,
      obpm: 2.6,
      dbpm: -0.5,
      bpm: 2,
      vorp: 1.8,
      ewa: 5.7,
      minMax: [41],
      fgMax: [12],
      fgaMax: [24],
      tpMax: [6],
      tpaMax: [13],
      "2pMax": [8],
      "2paMax": [15],
      ftMax: [10],
      ftaMax: [13],
      orbMax: [5],
      drbMax: [19],
      trbMax: [20],
      astMax: [9],
      stlMax: [4],
      blkMax: [2],
      tovMax: [6],
      pfMax: [4],
      ptsMax: [33],
      gmscMax: [30.4],
      pmMax: [18],
    },
  ],
  injury: { type: "Healthy", gamesRemaining: 0 },
}
